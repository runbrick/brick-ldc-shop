<%- include('partials/header', { title: '商品管理', user }) %>
<h1 class="text-xl font-bold text-platform-primary mb-8">商品列表</h1>
<a href="/admin/products/new" class="btn-primary mb-6 cursor-pointer">新建商品</a>
<div class="platform-card overflow-hidden border border-slate-200">
  <table class="w-full text-left">
    <thead class="border-b border-slate-200 bg-slate-50">
      <tr>
        <th class="px-4 py-3 text-platform-muted font-medium text-sm">ID</th>
        <th class="px-4 py-3 text-platform-muted font-medium text-sm">名称</th>
        <th class="px-4 py-3 text-platform-muted font-medium text-sm">价格</th>
        <th class="px-4 py-3 text-platform-muted font-medium text-sm">库存</th>
        <th class="px-4 py-3 text-platform-muted font-medium text-sm">状态</th>
        <th class="px-4 py-3 text-platform-muted font-medium text-sm">操作</th>
      </tr>
    </thead>
    <tbody>
      <% (products || []).forEach(function(p) { %>
      <tr class="border-b border-slate-200 hover:bg-slate-50 transition-colors duration-200">
        <td class="px-4 py-3 text-platform-primary"><%= p.id %></td>
        <td class="px-4 py-3 text-platform-primary"><%= p.name %></td>
        <td class="px-4 py-3 text-platform-primary">¥ <%= Number(p.price).toFixed(2) %></td>
        <td class="px-4 py-3 text-platform-primary"><%= p.stock === -1 ? '无限' : p.stock %></td>
        <td class="px-4 py-3">
          <% if (p.status === 1) { %><span class="text-green-700 font-medium">上架</span><% } else { %><span class="text-slate-500">下架</span><% } %>
          <%= p.card_mode === 1 ? '· 循环' : '' %>
        </td>
        <td class="px-4 py-3">
          <a href="/admin/products/<%= p.id %>/cards" class="text-primary hover:underline cursor-pointer">卡密</a>
          <a href="/admin/products/<%= p.id %>/edit" class="text-platform-muted hover:underline cursor-pointer ml-2">编辑</a>
          <form action="/admin/products/<%= p.id %>/toggle-status" method="post" class="inline ml-2">
            <button type="submit" class="text-primary hover:underline cursor-pointer"><%= p.status === 1 ? '下架' : '上架' %></button>
          </form>
          <form action="/admin/products/<%= p.id %>/delete" method="post" class="inline ml-2" onsubmit="return confirm('确定删除？');">
            <button type="submit" class="text-red-600 hover:underline cursor-pointer">删除</button>
          </form>
        </td>
      </tr>
      <% }); %>
    </tbody>
  </table>
  <% if (!products || products.length === 0) { %>
  <div class="p-16 text-center text-platform-soft">暂无商品</div>
  <% } %>
</div>
<%- include('partials/pagination', { basePath: '/admin/products', pagination: typeof pagination !== 'undefined' ? pagination : null, query: typeof query !== 'undefined' ? query : {} }) %>
<%- include('partials/footer') %>
