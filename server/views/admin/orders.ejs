<%- include('partials/header', { title: '订单管理', user }) %>
<h1 class="text-xl font-bold text-slate-900 mb-6">订单列表</h1>
<% if (typeof query !== 'undefined' && query.error === 'refund') { %>
<div class="bg-amber-50 border border-amber-200 text-amber-800 rounded-lg p-3 mb-4">退款操作失败或订单状态不允许退款</div>
<% } %>
<div class="bg-white rounded-lg border border-slate-200 overflow-hidden">
  <table class="w-full text-left">
    <thead class="bg-slate-50 border-b border-slate-200">
      <tr>
        <th class="px-4 py-3 text-slate-600 font-medium">订单号</th>
        <th class="px-4 py-3 text-slate-600 font-medium">商品</th>
        <th class="px-4 py-3 text-slate-600 font-medium">金额</th>
        <th class="px-4 py-3 text-slate-600 font-medium">状态</th>
        <th class="px-4 py-3 text-slate-600 font-medium">时间</th>
        <th class="px-4 py-3 text-slate-600 font-medium">操作</th>
      </tr>
    </thead>
    <tbody>
      <% (orders || []).forEach(function(o) { %>
      <tr class="border-b border-slate-100">
        <td class="px-4 py-3 font-mono text-sm"><%= o.order_no %></td>
        <td class="px-4 py-3"><%= o.product_name %> x<%= o.quantity %></td>
        <td class="px-4 py-3">¥ <%= Number(o.amount).toFixed(2) %></td>
        <td class="px-4 py-3"><%= o.status %></td>
        <td class="px-4 py-3 text-slate-500 text-sm"><%= o.created_at %></td>
        <td class="px-4 py-3">
          <% if (o.status === 'paid' && o.epay_trade_no) { %>
          <form action="/admin/orders/<%= o.id %>/refund" method="post" class="inline" onsubmit="return confirm('确定退款？');">
            <button type="submit" class="text-amber-600 hover:underline cursor-pointer">退款</button>
          </form>
          <% } %>
        </td>
      </tr>
      <% }); %>
    </tbody>
  </table>
  <% if (!orders || orders.length === 0) { %>
  <div class="p-12 text-center text-slate-500">暂无订单</div>
  <% } %>
</div>
<%- include('partials/footer') %>
